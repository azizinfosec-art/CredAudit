<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>CredAudit Report</title>
  <style>
    :root{
      --bg: #0b0f14;
      --fg: #d1e7f5;
      --muted:#6b7280;
      --panel:#0f1520;
      --border:#1f2a37;
      --code:#0d1320;
      --accent-teal:#22d3ee;
      --accent-emerald:#34d399;
      --accent-magenta:#e879f9;
      --chip:#0f172a;
      --shadow: 0 0 0 1px rgba(255,255,255,0.04) inset, 0 10px 30px rgba(0,0,0,0.35);
      --glow-teal: 0 0 0 1px rgba(34,211,238,.25), 0 0 18px rgba(34,211,238,.12);
      --glow-emerald: 0 0 0 1px rgba(52,211,153,.25), 0 0 18px rgba(52,211,153,.12);
      --glow-magenta: 0 0 0 1px rgba(232,121,249,.25), 0 0 18px rgba(232,121,249,.12);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; background:var(--bg); color:var(--fg);
      font-family: system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Inter,Arial,sans-serif;
      line-height:1.35; position:relative; overflow-y:overlay;
    }
    /* animated scanline grid */
    body::before{
      content:""; position:fixed; inset:0; pointer-events:none; z-index:0;
      background:
        linear-gradient(transparent 95%, rgba(34,211,238,.06) 96%),
        linear-gradient(90deg, transparent 95%, rgba(232,121,249,.06) 96%);
      background-size: 100% 20px, 20px 100%;
      animation: gridShift 12s linear infinite;
      mix-blend-mode: screen;
    }
    @keyframes gridShift { 0%{ transform:translateY(0) } 100%{ transform:translateY(-20px) } }

    .app{ position:relative; z-index:1; display:grid; grid-template-columns: 280px 1fr; gap:16px; padding:16px; }
    @media (max-width: 980px){ .app{ grid-template-columns: 1fr; } }

    /* Header */
    .topbar{ display:flex; justify-content:space-between; align-items:center; padding:12px 14px; border:1px solid var(--border); border-radius:12px; background:linear-gradient(180deg, rgba(15,22,34,.85), rgba(10,14,22,.85)); box-shadow: var(--shadow); }
    .brand{ display:flex; align-items:center; gap:10px; font-weight:700; letter-spacing:.3px; }
    .brand .title{ font-size:18px; text-shadow: 0 0 18px rgba(34,211,238,.35); }
    .badge{ font-size:12px; padding:2px 8px; border-radius:999px; border:1px solid rgba(34,211,238,.35); color:var(--accent-teal); background:rgba(34,211,238,.07) }
    .author{ font-size:12px; color:var(--muted) }
    .author a{ color:var(--accent-emerald); text-decoration:none }
    .author a:hover{ text-decoration:underline }

    .summary{ display:flex; flex-wrap:wrap; gap:8px; align-items:center }
    .chip{ display:inline-flex; align-items:center; gap:8px; padding:6px 10px; background:var(--chip); border:1px solid var(--border); border-radius:999px; font-size:12px; box-shadow: var(--shadow); }
    .chip .spark{ display:inline-block; width:46px; height:10px; background: linear-gradient(90deg, rgba(34,211,238,.7), rgba(232,121,249,.7)); border-radius:4px; filter: blur(.2px) }
    .chip.count{ color:var(--fg) }
    .chip.elapsed{ color:var(--muted) }

    /* Layout panes */
    .sidebar{ border:1px solid var(--border); background:var(--panel); border-radius:12px; padding:12px; box-shadow: var(--shadow); position:sticky; top:16px; height: fit-content; }
    .sidebar h3{ margin:6px 0 8px; font-size:12px; color:var(--muted); text-transform:uppercase; letter-spacing:.08em }
    .group{ display:flex; flex-wrap:wrap; gap:8px }
    .toggle{ cursor:pointer; user-select:none; padding:6px 10px; border-radius:999px; border:1px solid var(--border); background:var(--chip); font-size:12px }
    .toggle.active{ box-shadow: var(--glow-emerald); border-color: rgba(52,211,153,.5) }
    .toggle.magenta.active{ box-shadow: var(--glow-magenta); border-color: rgba(232,121,249,.5) }
    .toggle.teal.active{ box-shadow: var(--glow-teal); border-color: rgba(34,211,238,.5) }
    .field{ display:flex; gap:8px; align-items:center; margin:8px 0 }
    .field input{ flex:1; padding:8px 10px; border-radius:8px; border:1px solid var(--border); background:var(--code); color:var(--fg) }

    /* Main content */
    .panel{ border:1px solid var(--border); background:var(--panel); border-radius:12px; padding:12px; box-shadow: var(--shadow); }
    .toolbar{ display:flex; gap:8px; align-items:center; flex-wrap:wrap; margin-bottom:10px }
    .toolbar input[type="text"]{ padding:8px 10px; border:1px solid var(--border); border-radius:8px; background:var(--code); color:var(--fg); min-width:260px }
    .toolbar .actions{ display:flex; gap:8px; flex-wrap:wrap }
    .btn{ padding:8px 10px; border-radius:8px; border:1px solid var(--border); background:var(--chip); color:var(--fg); cursor:pointer }
    .btn:hover{ box-shadow: var(--glow-teal) }

    table{ width:100%; border-collapse:separate; border-spacing:0; table-layout:fixed }
    thead th{ position:sticky; top:0; background:rgba(15,22,34,.95); backdrop-filter: blur(4px); z-index:2; text-align:left; border-bottom:1px solid var(--border); padding:10px 8px; font-size:12px; cursor:pointer }
    tbody td{ border-bottom:1px solid var(--border); padding:10px 8px; font-size:13px; vertical-align:top }
    .wrap{ word-break:break-word }
    .path{ font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace }
    .sevBadge{ display:inline-block; padding:2px 8px; border-radius:999px; font-size:12px; border:1px solid var(--border) }
    .sev-High .sevBadge{ color:#ffd6ff; box-shadow: var(--glow-magenta) }
    .sev-Medium .sevBadge{ color:#ffe9b0; box-shadow: var(--glow-emerald) }
    .sev-Low .sevBadge{ color:#c0f7ff; box-shadow: var(--glow-teal) }
    .rowActions{ opacity:0; transition:opacity .15s; display:flex; gap:8px }
    tbody tr:hover .rowActions{ opacity:1 }
    code{ background:var(--code); padding:2px 4px; border-radius:4px }
    .snippet{ display:none; margin-top:8px; padding:10px; background:#0b1220; border:1px solid var(--border); border-radius:8px; font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; font-size:12px; box-shadow: var(--shadow) }
    .hl{ color:#fff; background: rgba(232,121,249,.22); box-shadow:inset 0 0 0 1px rgba(232,121,249,.35) }

    /* Sticky footer actions */
    .footerbar{ position:sticky; bottom:0; margin-top:12px; display:flex; gap:8px; flex-wrap:wrap; padding:10px; background:rgba(10,14,22,.9); border:1px solid var(--border); border-radius:12px; box-shadow: var(--shadow) }

    /* Print */
    @media print{
      .sidebar, .toolbar, .footerbar { display:none }
      body{ background:#fff; color:#000 }
      .snippet{ display:none !important }
    }
  </style>
</head>
<body>
  <div class="app">
    <div class="topbar" style="grid-column: 1 / -1">
      <div class="brand">
        <div class="title">CredAudit Report</div>
        <span class="badge">v0.3.16</span>
        <span class="author">by <a href="https://github.com/azizinfosec-art/CredAudit" target="_blank" rel="noopener">azizinfosec-art</a></span>
      </div>
      <div class="summary">
        <span class="chip count">Total <b>20</b><span class="spark"></span></span>
        <span class="chip count" title="High"><svg width="10" height="10" viewBox="0 0 10 10" aria-hidden="true"><circle cx="5" cy="5" r="4" fill="currentColor" style="color:var(--accent-magenta)"></circle></svg> 0</span>
        <span class="chip count" title="Medium"><svg width="10" height="10" viewBox="0 0 10 10" aria-hidden="true"><circle cx="5" cy="5" r="4" fill="currentColor" style="color:#ffd166"></circle></svg> 20</span>
        <span class="chip count" title="Low"><svg width="10" height="10" viewBox="0 0 10 10" aria-hidden="true"><circle cx="5" cy="5" r="4" fill="currentColor" style="color:var(--accent-teal)"></circle></svg> 0</span>
        <span class="chip elapsed" title="Generated at">2025-09-07 23:57:52</span>
      </div>
    </div>

    <!-- Sidebar Filters -->
    <aside class="sidebar" id="filterPane">
      <h3>Severity</h3>
      <div class="group">
        <label class="toggle magenta"><input type="checkbox" id="sevHigh" checked style="display:none"/> High</label>
        <label class="toggle emerald"><input type="checkbox" id="sevMed" checked style="display:none"/> Medium</label>
        <label class="toggle teal"><input type="checkbox" id="sevLow" checked style="display:none"/> Low</label>
      </div>
      <h3>File Types</h3>
      <div class="group" id="extGroup"></div>
      <h3>Rule Groups</h3>
      <div class="group" id="ruleGroup"></div>
      <h3>Globs</h3>
      <div class="field"><input id="incGlob" placeholder="Include glob(s), comma separated" /></div>
      <div class="field"><input id="excGlob" placeholder="Exclude glob(s), comma separated" /></div>
    </aside>

    <!-- Main Content -->
    <main class="panel">
      <div class="toolbar">
        <input id="q" type="text" placeholder="Search rule / file / value (fuzzy)" />
        <div class="actions">
          <button class="btn" id="toggleTheme">Theme</button>
          <button class="btn" id="toggleRaw">Show Raw</button>
          <button class="btn" id="clear">Clear</button>
          <a class="btn" href="report_20250907_235751.json" download>Download JSON</a>
          <a class="btn" href="report_20250907_235751.csv" download>Download CSV</a>
        </div>
      </div>

      <div style="max-height: 65vh; overflow:auto; border:1px solid var(--border); border-radius:10px">
        <table id="tbl">
          <thead>
            <tr>
              <th class="sortable" data-k="severity">Severity<span class="sortdir"></span></th>
              <th class="sortable" data-k="file">File<span class="sortdir"></span></th>
              <th class="sortable" data-k="rule">Rule<span class="sortdir"></span></th>
              <th>Value</th>
              <th class="sortable" data-k="line">Line<span class="sortdir"></span></th>
              <th>Context</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>

      <div class="footerbar">
        <button class="btn" id="downloadCsv">Copy CSV (page)</button>
        <button class="btn" id="downloadCsvAll">Copy CSV (all filtered)</button>
        <button class="btn" id="goTop">Back to Top</button>
      </div>
      <div style="margin-top:8px; font-size:12px; color:var(--muted)">Press <b>/</b> to focus search · <b>f</b> filter pane · <b>g</b> top</div>
      <div id="pager" style="margin-top:8px"></div>
    </main>
  </div>

  <script>
  const DATA = [{"file": "C:\\Users\\Dell\\Downloads\\CredAudit-0.2.2-full\\credaudit_project_022_full\\tests\\secrets.txt", "rule": "PasswordAssignment", "match": "password: secret123", "redacted": "pass**********t123", "context": "password: secret123", "severity": "Medium", "line": 3}, {"file": "C:\\Users\\Dell\\Downloads\\CredAudit-0.2.2-full\\credaudit_project_022_full\\tests\\secrets.txt", "rule": "PasswordAssignment", "match": "api_key=sk-abcde1234567890", "redacted": "api_**********7890", "context": "api_key=sk-abcde1234567890", "severity": "Medium", "line": 4}, {"file": "C:\\Users\\Dell\\Downloads\\CredAudit-0.2.3-full\\credaudit_project_023_full\\tests\\secrets.txt", "rule": "PasswordAssignment", "match": "password: secret123", "redacted": "pass**********t123", "context": "password: secret123", "severity": "Medium", "line": 2}, {"file": "C:\\Users\\Dell\\Downloads\\CredAudit-0.2.3-full\\credaudit_project_023_full\\tests\\secrets.txt", "rule": "PasswordAssignment", "match": "api_key=sk-abcde1234567890", "redacted": "api_**********7890", "context": "api_key=sk-abcde1234567890", "severity": "Medium", "line": 3}, {"file": "C:\\Users\\Dell\\Downloads\\CredAudit-0.2.4-full\\credaudit_project_024_full\\tests\\secrets.txt", "rule": "PasswordAssignment", "match": "password: secret123", "redacted": "pass**********t123", "context": "password: secret123", "severity": "Medium", "line": 2}, {"file": "C:\\Users\\Dell\\Downloads\\CredAudit-0.2.4-full\\credaudit_project_024_full\\tests\\secrets.txt", "rule": "PasswordAssignment", "match": "api_key=sk-abcde1234567890", "redacted": "api_**********7890", "context": "api_key=sk-abcde1234567890", "severity": "Medium", "line": 3}, {"file": "C:\\Users\\Dell\\Downloads\\CredAudit-0.2.5-full\\credaudit_project_025_full\\tests\\secrets.txt", "rule": "PasswordAssignment", "match": "password: secret123", "redacted": "pass**********t123", "context": "password: secret123", "severity": "Medium", "line": 2}, {"file": "C:\\Users\\Dell\\Downloads\\CredAudit-0.2.5-full\\credaudit_project_025_full\\tests\\secrets.txt", "rule": "PasswordAssignment", "match": "api_key=sk-abcde1234567890", "redacted": "api_**********7890", "context": "api_key=sk-abcde1234567890", "severity": "Medium", "line": 3}, {"file": "C:\\Users\\Dell\\Downloads\\CredAudit-0.2.6-full\\credaudit_project_026_full\\tests\\secrets.txt", "rule": "PasswordAssignment", "match": "password: secret123", "redacted": "pass**********t123", "context": "password: secret123", "severity": "Medium", "line": 2}, {"file": "C:\\Users\\Dell\\Downloads\\CredAudit-0.2.6-full\\credaudit_project_026_full\\tests\\secrets.txt", "rule": "PasswordAssignment", "match": "api_key=sk-abcde1234567890", "redacted": "api_**********7890", "context": "api_key=sk-abcde1234567890", "severity": "Medium", "line": 3}, {"file": "C:\\Users\\Dell\\Downloads\\CredAudit-0.3.0-full\\credaudit_project_030_full\\tests\\secrets.txt", "rule": "PasswordAssignment", "match": "password: secret123", "redacted": "pass**********t123", "context": "password: secret123", "severity": "Medium", "line": 2}, {"file": "C:\\Users\\Dell\\Downloads\\CredAudit-0.3.0-full\\credaudit_project_030_full\\tests\\secrets.txt", "rule": "PasswordAssignment", "match": "api_key=sk-abcde1234567890", "redacted": "api_**********7890", "context": "api_key=sk-abcde1234567890", "severity": "Medium", "line": 3}, {"file": "C:\\Users\\Dell\\Downloads\\CredAudit-0.3.4-final\\credaudit_project_034_full\\tests\\excel.xlsx", "rule": "PasswordAssignment", "match": "password: secret123", "redacted": "pass**********t123", "context": "password: secret123", "severity": "Medium", "line": 1}, {"file": "C:\\Users\\Dell\\Downloads\\CredAudit-0.3.4-final\\credaudit_project_034_full\\tests\\secrets.txt", "rule": "PasswordAssignment", "match": "password: secret123", "redacted": "pass**********t123", "context": "password: secret123", "severity": "Medium", "line": 2}, {"file": "C:\\Users\\Dell\\Downloads\\CredAudit-0.3.4-final\\credaudit_project_034_full\\tests\\secrets.txt", "rule": "PasswordAssignment", "match": "api_key=sk-abcde1234567890", "redacted": "api_**********7890", "context": "api_key=sk-abcde1234567890", "severity": "Medium", "line": 3}, {"file": "C:\\Users\\Dell\\Downloads\\CredAudit\\CredAudit\\sample_data\\secrets.txt", "rule": "PasswordAssignment", "match": "password: secret123", "redacted": "pass**********t123", "context": "password: secret123", "severity": "Medium", "line": 2}, {"file": "C:\\Users\\Dell\\Downloads\\CredAudit\\CredAudit\\sample_data\\secrets.txt", "rule": "PasswordAssignment", "match": "api_key=sk-abcde1234567890", "redacted": "api_**********7890", "context": "api_key=sk-abcde1234567890", "severity": "Medium", "line": 3}, {"file": "C:\\Users\\Dell\\Downloads\\credaudit_0.2.2\\tests\\secrets.txt", "rule": "PasswordAssignment", "match": "password: secret123", "redacted": "pass**********t123", "context": "password: secret123", "severity": "Medium", "line": 3}, {"file": "C:\\Users\\Dell\\Downloads\\credaudit_0.2.2\\tests\\secrets.txt", "rule": "PasswordAssignment", "match": "api_key=sk-abcde1234567890", "redacted": "api_**********7890", "context": "api_key=sk-abcde1234567890", "severity": "Medium", "line": 4}, {"file": "C:\\Users\\Dell\\Downloads\\July-Drop-Backend-APIs.xlsx", "rule": "PasswordAssignment", "match": "password=Password@2024'", "redacted": "pass**********024'", "context": "--data-urlencode 'password=Password@2024' \\", "severity": "Medium", "line": 3891}];
  const BASE_NAME = "report_20250907_235751";
  const CSV_NAME = "report_20250907_235751.json";
  (function(){
    const tbl=document.getElementById('tbl'); const q=document.getElementById('q'); const pager=document.getElementById('pager');
    const btnTheme=document.getElementById('toggleTheme'); const btnRaw=document.getElementById('toggleRaw'); const btnClear=document.getElementById('clear');
    const btnDownload=document.getElementById('downloadCsv'); const btnDownloadAll=document.getElementById('downloadCsvAll');
    const cbH=document.getElementById('sevHigh'); const cbM=document.getElementById('sevMed'); const cbL=document.getElementById('sevLow');
    const extGroup=document.getElementById('extGroup'); const ruleGroup=document.getElementById('ruleGroup');
    const incGlob=document.getElementById('incGlob'); const excGlob=document.getElementById('excGlob');
    const goTop=document.getElementById('goTop');
    // legacy control retained for compatibility
    const selPageSize = (function(){ const s=document.createElement('select'); s.id='pageSize'; s.style.display='none'; s.innerHTML='<option value="500">500</option>'; document.body.appendChild(s); return s; })();

    let showRaw=false; let filtered=[...DATA]; let page=1; let PAGE_SIZE=500; let sortKey=null; let sortDir='asc';
    const sevRank={High:3, Medium:2, Low:1};
    const qsa=(s,el=document)=>Array.from(el.querySelectorAll(s));

    // Build filter chips from data
    const exts = Array.from(new Set(DATA.map(f=>{const m=(f.file||'').toLowerCase().match(/\.([a-z0-9]+)$/); return m?m[1]:'';}))).filter(Boolean).sort();
    const rules = Array.from(new Set(DATA.map(f=>f.rule||''))).filter(Boolean).sort();
    const extState = new Map(exts.map(e=>[e,true]));
    const ruleState = new Map(rules.map(r=>[r,true]));

    function chip(label, map, key, color){
      const el=document.createElement('label'); el.className='toggle '+(color||''); el.textContent=label; el.tabIndex=0;
      el.addEventListener('click',()=>{ const v=!(map.get(key)); map.set(key,v); el.classList.toggle('active', v); applyFiltersDebounced(); });
      el.classList.toggle('active', map.get(key));
      return el;
    }
    exts.forEach(e=>extGroup.appendChild(chip('.'+e, extState, e, 'teal')));
    rules.forEach(r=>ruleGroup.appendChild(chip(r, ruleState, r, '')));

    // Severity toggles styling
    function syncSev(){
      elH.classList.toggle('active', cbH.checked); elM.classList.toggle('active', cbM.checked); elL.classList.toggle('active', cbL.checked);
    }
    const elH = cbH.parentElement, elM=cbM.parentElement, elL=cbL.parentElement; syncSev();
    elH.addEventListener('click', ()=>{ cbH.checked=!cbH.checked; syncSev(); applyFiltersDebounced(); });
    elM.addEventListener('click', ()=>{ cbM.checked=!cbM.checked; syncSev(); applyFiltersDebounced(); });
    elL.addEventListener('click', ()=>{ cbL.checked=!cbL.checked; syncSev(); applyFiltersDebounced(); });

    // Fuzzy search: ordered subsequence match
    function fuzzy(hay, needle){
      hay = (hay||'').toLowerCase(); needle=(needle||'').toLowerCase(); if(!needle) return true;
      let j=0; for(let i=0;i<hay.length && j<needle.length;i++){ if(hay[i]===needle[j]) j++; } return j===needle.length;
    }

    // Simple glob -> regex
    function globToReg(g){
      g = g.replace(/[.+^${}()|\[\]\\]/g,'\\$&').replace(/\*/g,'.*').replace(/\?/g,'.');
      return new RegExp('^'+g+'$','i');
    }

    function applyFilters(){
      const term=(q.value||'').trim();
      const allow={High:cbH.checked, Medium:cbM.checked, Low:cbL.checked};
      const inc = (incGlob.value||'').split(/[,\s]+/).filter(Boolean).map(globToReg);
      const exc = (excGlob.value||'').split(/[,\s]+/).filter(Boolean).map(globToReg);
      filtered = DATA.filter(f=>{
        const sev=f.severity||'Low'; if(!allow[sev]) return false;
        const fp=(f.file||''); const ext=(fp.toLowerCase().match(/\.([a-z0-9]+)$/)||['',''])[1]; if(ext && extState.has(ext) && !extState.get(ext)) return false;
        const rl=(f.rule||''); if(ruleState.has(rl) && !ruleState.get(rl)) return false;
        if(inc.length && !inc.some(rx=>rx.test(fp))) return false;
        if(exc.some(rx=>rx.test(fp))) return false;
        if(!term) return true;
        return fuzzy(f.rule, term) || fuzzy(f.file, term) || fuzzy(f.redacted||f.match||'', term);
      });
      page=1; renderRows();
    }
    const applyFiltersDebounced = debounce(applyFilters, 200);

    function debounce(fn, ms){ let t; return function(){ clearTimeout(t); t=setTimeout(fn, ms); }; }

    function highlight(text, match){ if(!text) return ''; if(!match) return text.replace(/</g,'&lt;'); const rx=new RegExp(match.replace(/[.*+?^${}()|[\]\\]/g,'\\$&'),'ig'); return text.replace(/</g,'&lt;').replace(rx, m=>`<span class="hl">${m}</span>`); }

    function renderRows(){
      // Sort
      if(sortKey){
        const cmp=(a,b)=>{
          let va, vb;
          if(sortKey==='severity'){ va=sevRank[a.severity]||0; vb=sevRank[b.severity]||0; }
          else if(sortKey==='file'){ va=(a.file||'').toLowerCase(); vb=(b.file||'').toLowerCase(); }
          else if(sortKey==='rule'){ va=(a.rule||'').toLowerCase(); vb=(b.rule||'').toLowerCase(); }
          else if(sortKey==='line'){ va=parseInt(a.line||0)||0; vb=parseInt(b.line||0)||0; }
          else { va=''; vb=''; }
          return (va>vb?1:va<vb?-1:0) * (sortDir==='asc'?1:-1);
        };
        filtered = filtered.slice().sort(cmp);
      }
      const start=(page-1)*PAGE_SIZE; const end=Math.min(filtered.length, start+PAGE_SIZE);
      const rows=[];
      for(let i=start;i<end;i++){
        const f=filtered[i]; const sev=f.severity||'Low';
        rows.push(
          `<tr class="sev-${sev}" data-idx="${i}">`+
            `<td class="nowrap"><span class="sevBadge">${sev}</span></td>`+
            `<td class="path wrap">${(f.file||'').replace(/</g,'&lt;')}</td>`+
            `<td class="wrap">${(f.rule||'').replace(/</g,'&lt;')}</td>`+
            `<td class="wrap">`+
              `<div style="display:flex;align-items:center;gap:8px">`+
                `<code class="val" data-raw="${(f.match||'').replace(/&/g,'&amp;').replace(/"/g,'&quot;')}" data-redacted="${(f.redacted||'').replace(/&/g,'&amp;').replace(/"/g,'&quot;')}">${(f.redacted||'').replace(/&/g,'&amp;').replace(/</g,'&lt;')}</code>`+
                `<span class="rowActions"><button class="btn small copyR">Copy</button><button class="btn small copyRaw">Raw</button></span>`+
              `</div>`+
              `<div class="snippet">${highlight(f.context||'', f.match||'')}</div>`+
            `</td>`+
            `<td class="nowrap">${f.line||''}</td>`+
            `<td class="wrap"><code>${(f.context||'').replace(/</g,'&lt;')}</code></td>`+
          `</tr>`
        );
      }
      tbl.querySelector('tbody').innerHTML = rows.join('');
      // Row interactions
      qsa('tbody tr', tbl).forEach(tr=>{
        tr.addEventListener('click', (e)=>{ if(e.target.closest('.rowActions')) return; const sn=tr.querySelector('.snippet'); sn.style.display = sn.style.display==='block' ? 'none' : 'block'; });
        const copyR=tr.querySelector('.copyR'); const copyRaw=tr.querySelector('.copyRaw'); const code=tr.querySelector('code.val');
        copyR.addEventListener('click', (e)=>{ e.stopPropagation(); copyToClipboard(code.dataset.redacted||''); });
        copyRaw.addEventListener('click', (e)=>{ e.stopPropagation(); if(confirm('Copy raw secret?')) copyToClipboard(code.dataset.raw||''); });
      });
      renderPager(Math.max(1, Math.ceil(filtered.length / PAGE_SIZE)));
    }

    function renderPager(total){
      function btn(lbl,target,dis=false,act=false){ const b=document.createElement('button'); b.className='btn'; b.textContent=lbl; if(dis) b.disabled=true; if(act) b.style.fontWeight='bold'; b.addEventListener('click', ()=>{ page=target; renderRows(); }); return b; }
      pager.innerHTML='';
      pager.appendChild(btn('<< First',1,page===1)); pager.appendChild(btn('< Prev', Math.max(1,page-1), page===1));
      const win=3; let s=Math.max(1,page-win), e=Math.min(total,page+win); if(s>1){ pager.appendChild(btn('1',1,false,page===1)); if(s>2){ const dots=document.createElement('span'); dots.textContent='...'; dots.style.padding='6px'; pager.appendChild(dots);} }
      for(let p=s;p<=e;p++){ pager.appendChild(btn(String(p),p,false,p===page)); }
      if(e<total){ if(e<total-1){ const dots=document.createElement('span'); dots.textContent='...'; dots.style.padding='6px'; pager.appendChild(dots);} pager.appendChild(btn(String(total), total, false, page===total)); }
      pager.appendChild(btn('Next >', Math.min(total,page+1), page===total)); pager.appendChild(btn('Last >>', total, page===total));
    }

    function copyToClipboard(text){ navigator.clipboard?.writeText(text).then(()=>toast('Copied')).catch(()=>{ const ta=document.createElement('textarea'); ta.value=text; document.body.appendChild(ta); ta.select(); try{ document.execCommand('copy'); toast('Copied'); } finally { ta.remove(); } }); }
    function toast(msg){ let t=document.getElementById('toast'); if(!t){ t=document.createElement('div'); t.id='toast'; t.style.position='fixed'; t.style.left='50%'; t.style.bottom='16px'; t.style.transform='translateX(-50%)'; t.style.background='var(--panel)'; t.style.color='var(--fg)'; t.style.border='1px solid var(--border)'; t.style.padding='8px 12px'; t.style.borderRadius='8px'; t.style.fontSize='12px'; t.style.boxShadow='var(--shadow)'; document.body.appendChild(t); } t.textContent=msg; t.style.opacity='1'; setTimeout(()=>{ t.style.opacity='0'; }, 1000); }

    // Sorting
    qsa('thead th.sortable', tbl).forEach(th=>{
      th.addEventListener('click', ()=>{ const k=th.dataset.k; sortDir = (sortKey===k && sortDir==='asc') ? 'desc' : 'asc'; sortKey=k; qsa('thead th .sortdir', tbl).forEach(s=>s.textContent=''); th.querySelector('.sortdir').textContent = sortDir==='asc' ? ' ▲' : ' ▼'; renderRows(); });
    });

    // Toolbar actions
    function applyTheme(t){ if(t==='dark') document.body.classList.add('dark'); else document.body.classList.remove('dark'); }
    const saved=localStorage.getItem('credtheme'); if(saved){ applyTheme(saved); }
    btnTheme.addEventListener('click', ()=>{ const d=document.body.classList.toggle('dark'); localStorage.setItem('credtheme', d?'dark':'light'); });
    btnRaw.addEventListener('click', ()=>{ showRaw=!showRaw; btnRaw.textContent = showRaw ? 'Hide Raw' : 'Show Raw'; qsa('code.val').forEach(el=>{ el.textContent = showRaw ? el.dataset.raw : el.dataset.redacted; }); });
    btnClear.addEventListener('click', ()=>{ q.value=''; incGlob.value=''; excGlob.value=''; extState.forEach((_,k)=>extState.set(k,true)); ruleState.forEach((_,k)=>ruleState.set(k,true)); qsa('.group .toggle').forEach(el=>el.classList.add('active')); cbH.checked=cbM.checked=cbL.checked=true; applyFilters(); });
    q.addEventListener('input', applyFiltersDebounced);
    incGlob.addEventListener('input', applyFiltersDebounced); excGlob.addEventListener('input', applyFiltersDebounced);
    btnDownload.addEventListener('click', ()=>{ copyCsv(false); }); btnDownloadAll.addEventListener('click', ()=>{ copyCsv(true); });
    goTop.addEventListener('click', ()=>{ window.scrollTo({top:0, behavior:'smooth'}); });

    function copyCsv(all){
      const esc=v=>'"'+String(v==null?'':v).replace(/"/g,'""')+'"';
      const header=['severity','file','rule','value','line','context']; const lines=[header.map(esc).join(',')];
      const start = all? 0 : (page-1)*PAGE_SIZE; const end = all? filtered.length : Math.min(filtered.length,start+PAGE_SIZE);
      for(let i=start;i<end;i++){ const f=filtered[i]; const row=[ f.severity||'', f.file||'', f.rule||'', (showRaw?(f.match||''):(f.redacted||'')), f.line||'', f.context||'' ]; lines.push(row.map(esc).join(',')); }
      copyToClipboard(lines.join('\r\n'));
      toast(all? 'CSV (filtered) copied' : 'CSV (page) copied');
    }

    // Shortcuts
    document.addEventListener('keydown', (e)=>{
      const tag=(e.target&&e.target.tagName)||''; if(tag==='INPUT'||tag==='SELECT'||(e.target&&e.target.isContentEditable)) return;
      const k=(e.key||'').toLowerCase(); if(k==='/'){ e.preventDefault(); q.focus(); } else if(k==='f'){ e.preventDefault(); document.getElementById('filterPane').scrollIntoView({behavior:'smooth', block:'nearest'}); } else if(k==='g'){ e.preventDefault(); window.scrollTo({top:0,behavior:'smooth'}); }
    });

    // Initial render
    applyFilters();
  })();
  </script>
  <noscript>
    <div class="panel" style="margin:16px">JavaScript is disabled. A static table is required for print/export.</div>
  </noscript>
  <div id="toast" class="toast hidden" role="status" aria-live="polite"></div>
</body>
</html>
